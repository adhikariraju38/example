<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DOCX Fullscreen Viewer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root {
        --bg: #0f111a;
        --card: #1f2330;
        --border: 2px solid #2f3245;
        --text: #e8eaf6;
        --muted: #8f93b3;
      }
      * {
        box-sizing: border-box;
      }
      body {
        /* width: 90%; */
        background: linear-gradient(135deg, #0e1020, #1f2330);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        color: #fff;
        font-size: small;
        min-height: 100vh;
        /* display: flex;
        flex: 1; */
        /* justify-content: center;
        align-items: center; */
      }
      #viewer-wrapper {
        margin-top: 2em;
        margin-bottom: 2em;
        margin-left: 2em;
        margin-right: 2em;
        overflow: auto;
      }

      #output {
        flex: 1;
        border: 1px solid gray;
        border-radius: 25px;
        padding: 24px 32px;
        overflow: auto;
        background: #0f111a;
      }
      .loader-overlay {
        position: absolute;
        inset: 0;
        background: rgba(15, 17, 26, 0.85);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 12px;
        z-index: 5;
        backdrop-filter: blur(4px);
      }
      .spinner {
        width: 60px;
        height: 60px;
        border: 6px solid rgba(255, 255, 255, 0.15);
        border-top-color: #7c8cff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .status {
        font-size: 14px;
        color: #c1c7e0;
      }
      .error-box {
        background: #2f1f2f;
        border: 1px solid #d55;
        padding: 14px 16px;
        border-radius: 8px;
        color: #ffb3b3;
        margin-top: 12px;
      }
      .note {
        font-size: 12px;
        margin-top: 8px;
        color: var(--muted);
      }
      a {
        color: #7c8cff;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.8/mammoth.browser.min.js"></script>
  </head>
  <body>
    <div id="viewer-wrapper" aria-label="DOCX viewer">
      <div id="header">
        <div id="title"></div>
        <div id="file-path"></div>
      </div>
      <div id="output" aria-live="polite"></div>
      <div class="loader-overlay" id="loader">
        <div class="spinner" aria-hidden="true"></div>
        <div class="status" id="loader-text">Loading document...</div>
        <div class="note">
          Must be served over HTTP/HTTPS; opening via file:// may fail.
        </div>
      </div>
    </div>

    <script>
      function getQueryParam(name) {
        return new URLSearchParams(window.location.search).get(name);
      }
      const defaultDocx = "Elevator.docx"; // fallback
      const fileParam = getQueryParam("file");
      const docxPath = fileParam ? decodeURIComponent(fileParam) : defaultDocx;

      const output = document.getElementById("output");
      const loader = document.getElementById("loader");
      const loaderText = document.getElementById("loader-text");
      // const filePathEl = document.getElementById("file-path");
      // filePathEl.textContent = docxPath;

      async function showError(msg, details) {
        loaderText.textContent = "Failed";
        const box = document.createElement("div");
        box.className = "error-box";
        box.innerHTML = `<strong>${msg}</strong><div style="margin-top:6px;">${
          details || ""
        }</div>
        <div style="margin-top:8px;font-size:11px;">Example override: <code>?file=path/to/YourDoc.docx</code></div>`;
        output.innerHTML = "";
        output.appendChild(box);
        setTimeout(() => {
          loader.style.display = "none";
        }, 800);
      }

      async function loadDocx(path) {
        try {
          loaderText.textContent = "Fetching " + path + "...";
          const resp = await fetch(path);
          if (!resp.ok) {
            throw new Error(`HTTP ${resp.status} ${resp.statusText}`);
          }
          const arrayBuffer = await resp.arrayBuffer();
          loaderText.textContent = "Converting to HTML...";
          const result = await mammoth.convertToHtml({ arrayBuffer });
          loader.style.display = "none";
          output.innerHTML =
            result.value || "<p><em>(no content extracted)</em></p>";
          if (result.messages && result.messages.length) {
            const msgContainer = document.createElement("div");
            msgContainer.style.marginTop = "1rem";
            msgContainer.style.fontSize = "12px";
            msgContainer.style.color = "#aaa";
            msgContainer.textContent =
              "Conversion notes: " +
              result.messages.map((m) => m.message).join("; ");
            output.appendChild(msgContainer);
          }
        } catch (err) {
          await showError("Error loading/converting document.", err.message);
          console.error(err);
        }
      }

      loadDocx(docxPath);
    </script>
  </body>
</html>
